<!-- POS Screen (Cloudflare + Neon) -->
<div class="page">

  <!-- Standard screen chrome -->
  <div id="screen-banner" class="mb-3 hidden"></div>
  <div id="screen-access-denied" class="hidden">
    <div class="card p-3">Access denied</div>
  </div>
  <div id="screen-loading" class="card p-3">
    Loading POSâ€¦
  </div>

  <div id="screen-content" class="hidden">

    <!-- POS (search) local styles: consistent thumbnails + tidy result rows) -->
    <style>
      /* result row shell */
      .pos-result-row {
        display: flex; align-items: center; justify-content: space-between;
        gap: 0.75rem; padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;
      }
      .pos-result-left { display: flex; align-items: center; gap: 0.75rem; min-width: 0; }
      /* normalized thumbnail box */
      .pos-thumb {
        width: 96px; height: 96px; object-fit: cover; border-radius: 0.5rem; flex: 0 0 auto;
        background: #f3f4f6;
      }
      .pos-thumb--ph { display: inline-block; }
      .muted { color: #6b7280; }

      /* Sales-to-delist overdue highlight ( > 24 hours ) */
      #pos-sales-delist tr.delist-overdue td {
        background: #ff0000 !important;   /* bright red */
        color: #ffffff !important;        /* white text */
        font-weight: 700;
      }
      #pos-sales-delist tr.delist-overdue a,
      #pos-sales-delist tr.delist-overdue .link {
        color: #ffffff !important;
        text-decoration: underline;
      }
    </style>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    
    <!-- LEFT: Search / Results -->
    <div class="card p-3">
      <div class="flex items-center justify-between mb-2">
        <div class="section-title">Inventory Search</div>
      </div>
      <div class="flex items-center gap-2 mb-2">
        <input id="pos-search" class="input w-full" placeholder="Enter SKU" />
        <button id="pos-search-btn" class="btn btn-success">Search</button>
        <button id="pos-search-clear" class="btn btn-danger">Clear</button>
      </div>

        <div id="pos-results" class="space-y-2 max-h-[60vh] overflow-auto">
          <!-- search results with â€œAddâ€ buttons go here -->
        </div>
      </div>

      <!-- RIGHT: Ticket -->
      <div class="card p-3">
        <div class="pos-ticket-header mb-2">
          <div class="section-title">Ticket</div>
          
            <button id="pos-quick-misc" class="btn btn-success btn-sm">+ Misc</button>

            <div id="pos-quick-misc-prices" class="flex flex-wrap gap-1 items-center">
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="1">$1</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="2">$2</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="3">$3</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="4">$4</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="5">$5</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="10">$10</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="15">$15</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="20">$20</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="25">$25</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="30">$30</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="35">$35</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="40">$40</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="45">$45</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="50">$50</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="55">$55</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="60">$60</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="65">$65</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="70">$65</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="75">$75</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="80">$80</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="85">$85</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="90">$90</button>
              <button type="button" class="btn btn-ghost btn-sm" data-quick-misc="95">$95</button>
            </div>
         
          <button id="pos-ticket-empty" class="btn btn-danger btn-sm">Clear Ticket</button>
        </div>

        <!-- Full-width Ticket column: Cart â†’ Totals â†’ Payment row -->
        <div>
          <!-- CART (full width) -->
          <div id="pos-cart" class="grid grid-cols-1 gap-2">
            <!-- rows injected -->
          </div>

          <!-- TOTALS (share exact padding with item rows) -->
          <div class="mt-3 ticket-row ticket-row--totals">
            <!-- Match the item-row control bar layout -->
            <div class="ticket-controls flex items-center justify-between gap-2 flex-wrap">
              <!-- Left cluster (QTY spacer) â€” intentionally empty to keep columns consistent -->
              <div class="inline-flex items-center gap-1"></div>
          
              <!-- Right cluster (amount + action column) -->
              <div class="flex items-center gap-2 flex-1 justify-end flex-wrap">
                <div class="pos-totals text-right w-[320px] max-w-full">
                  <div class="flex justify-between py-1">
                    <span class="text-muted">Subtotal</span>
                    <span id="pos-subtotal">$0.00</span>
                  </div>
                  <div class="flex justify-between py-1">
                    <span class="text-muted">Discounts</span>
                    <span id="pos-discounts">$0.00</span>
                  </div>
                  <div class="flex justify-between py-1">
                    <span class="text-muted">Tax</span>
                    <span id="pos-tax">$0.00</span>
                  </div>
                  <div class="flex justify-between py-2 border-t mt-2 font-semibold">
                    <span>Total</span>
                    <span id="pos-total">$0.00</span>
                  </div>
                </div>
                <!-- Invisible placeholder = same width/shape as the real Remove button.
                     Keeps the outer edge identical to item rows. -->
                <button class="btn btn-ghost btn-xs btn-placeholder" aria-hidden="true" tabindex="-1">Remove</button>
              </div>
            </div>
          </div>

        <!-- Ticket-level Discount + Payment Method (same row) -->
        <div id="pos-ticket-discount" class="mt-3 p-2 border rounded">
          <div class="pos-ticket-discount-row">
            <!-- LEFT column -->
            <div class="pos-ticket-discount-left">
              <span class="pos-ticket-discount-label">Ticket Discount</span>
        
              <label>
                <input type="radio" name="ticket-discount-mode" value="percent" checked />
                <span>%</span>
              </label>
        
              <label>
                <input type="radio" name="ticket-discount-mode" value="amount" />
                <span>$</span>
              </label>
        
              <input
                id="pos-ticket-discount-input"
                class="input input-sm pos-discount-val"
                placeholder="0"
              />
        
              <button id="pos-ticket-discount-apply" class="btn btn-primary btn-sm">
                Apply
              </button>
            </div>
        
            <!-- RIGHT column -->
            <div class="pos-ticket-pay-inline">
              <select id="pos-payment" class="select pos-pay-item pos-w-method">
                <option value="" selected disabled>Select paymentâ€¦</option>
                <option value="cash">CASH</option>
                <option value="card:visa">Visa (Valor)</option>
                <option value="card:mastercard">MasterCard (Valor)</option>
                <option value="card:amex">Amex (Valor)</option>
                <option value="card:discover">Discover (Valor)</option>
                <option value="wallet:venmo">Venmo</option>
                <option value="wallet:zelle">Zelle</option>
                <option value="wallet:cashapp">Cash App</option>
              </select>
        
              <button id="pos-split" class="btn btn-ghost btn-sm pos-pay-item">Split payment</button>
            </div>
          </div>
        </div>
        
        <!-- PAYMENT ROW (now just the CTA) -->
        <div class="mt-2 pos-pay-row pos-compact">
          <button id="pos-complete" class="btn btn-primary pos-pay-item pos-pay-push" disabled>Complete Sale</button>
        </div>

        <!-- VALOR STATUS / FALLBACK (initially hidden; shown when card flow starts) -->
        <div id="pos-valor-bar" class="mt-2 hidden">
          <div class="card p-2 flex items-center gap-3 flex-wrap">
            <div class="text-sm">
              <span class="font-semibold">VALOR:</span>
              <span id="pos-valor-msg" class="align-middle">Idle</span>
            </div>
            
          </div>
        </div>


            <!-- anchor: VALOR FORCE-FINALIZE MODAL (inserted) -->
            <dialog id="pos-valor-modal" class="modal">
              <div class="modal-box max-w-md">
                <div class="text-lg font-semibold mb-2">Make a Selectionâ€¦</div>
                <p class="text-sm mb-3">
                  If the terminal already shows <span class="font-semibold">Approved</span> Finalize now.
                  If it shows <span class="font-semibold">Declined or Errors</span> you can retry immediately.
                </p>
                <div id="pos-valor-modal-text" class="text-sm bg-muted/30 rounded p-2 mb-3">
                  <div><span class="text-muted">Invoice:</span> <span id="pos-valor-invoice">â€”</span></div>
                  <div><span class="text-muted">Card amount:</span> <span id="pos-valor-amount">$0.00</span></div>
                </div>
                <div class="flex gap-2">
                  <button id="pos-valor-approve" class="btn btn-success flex-1">Terminal Approved â€” finalize</button>
                  <button id="pos-valor-retry" class="btn btn-danger flex-1">Resend Now/Card Declined/Error â€” retry</button>
                </div>
              </div>
           </dialog>
            <!-- /anchor: VALOR FORCE-FINALIZE MODAL -->
          
  
            <!-- CASH PANEL (inline; hidden until CASH selected) -->
              <div id="pos-cash-panel" class="card pos-panel pos-compact" style="display:none">
                <div class="section-title">Cash Payment</div>
                <div class="flex items-center gap-3 flex-wrap">
                <div class="pos-field">
                  <label>Total Due</label>
                  <div id="pos-cash-total-txt" class="pos-static pos-w-amount text-right">$0.00</div>
                </div>
                <div class="pos-field">
                  <label>Amount Received</label>
                  <input id="pos-cash-received" type="number" class="input input-sm pos-w-amount" inputmode="decimal" placeholder="0.00" />
                </div>
                <div class="pos-field">
                  <label>Change Due</label>
                  <div id="pos-cash-change-txt" class="pos-static pos-w-amount text-right">$0.00</div>
                </div>
                <div class="flex items-center gap-2 pos-push">
                  <button id="pos-cash-confirm" class="btn btn-primary btn-sm">Confirm Cash</button>
                  <button id="pos-cash-close" class="btn btn-ghost btn-sm">Close</button>
                </div>
              </div>
            </div>
  
            <!-- SPLIT PANEL (inline; hidden until Split clicked) -->
              <div id="pos-split-panel" class="card pos-panel pos-compact" style="display:none">
                <div class="section-title">Split Payment</div>
                <div class="flex items-center gap-2 flex-wrap mb-2">
                <select id="pos-split-method" class="select input-sm pos-w-method">
                  <option value="cash">CASH</option>
                  <option value="card:visa">Visa (Valor)</option>
                  <option value="card:mastercard">MasterCard (Valor)</option>
                  <option value="card:amex">Amex (Valor)</option>
                  <option value="card:discover">Discover (Valor)</option>
                  <option value="wallet:venmo">Venmo</option>
                  <option value="wallet:zelle">Zelle</option>
                  <option value="wallet:cashapp">Cash App</option>
                </select>
                <input id="pos-split-amount" type="number" class="input input-sm pos-w-amount" inputmode="decimal" placeholder="Amount" />
                <button id="pos-split-add" class="btn btn-ghost btn-sm">Add Payment</button>
              </div>
  
              <div class="overflow-auto">
                <table class="table w-full" id="pos-split-table">
                  <thead>
                    <tr>
                      <th class="text-left">Method</th>
                      <th class="text-left">Amount</th>
                      <th class="text-left">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="pos-split-body"><!-- rows injected --></tbody>
                </table>
              </div>
  
              <div class="flex items-center gap-2 mt-2">
                <div class="muted">Remaining:</div>
                <div id="pos-split-remaining" class="font-semibold">$0.00</div>
                <div class="flex items-center gap-2 pos-push">
                  <button id="pos-split-confirm" class="btn btn-primary btn-sm" disabled>Confirm Split</button>
                  <button id="pos-split-close" class="btn btn-ghost btn-sm">Close</button>
                </div>
              </div>
            </div>


            
            
        </div>

      </div>


       <!-- BELOW: Sales list (today/custom) -->
        <div id="pos-sales" class="card p-3 mt-3">
          <div class="flex items-center justify-between mb-2">
            <div class="section-title">Sales (Today / Custom)</div>
            <div class="flex items-center gap-2">
                <button id="pos-sales-today" class="btn btn-sm">Today</button>
              <span class="text-sm">or</span>
              <input id="pos-date-from" type="date" class="input input-sm" />
              <span class="text-sm">to</span>
              <input id="pos-date-to" type="date" class="input input-sm" />
              <button id="pos-sales-load" class="btn btn-sm btn-primary">Load</button>
            </div>
          </div>
          <div class="overflow-x-auto">
            <div class="table-wrap">
              <table class="table table-fixed">
                <colgroup>
                  <col style="width:120px" />
                  <col style="width:260px" />
                  <col style="width:40ch" /> <!-- Payment column fixed to ~40 characters -->
                  <col style="width:100px" />
                  <col style="width:140px" />
                </colgroup>
                <thead>
                  <tr>
                    <th class="text-left">Time</th>
                    <th class="text-left">Sale ID</th>
                    <th class="text-left">Payment</th>
                    <th class="text-left">Total</th>
                    <th class="text-left">Actions</th>
                  </tr>
                </thead>
                <tbody id="pos-sales-body">
                  <!-- rows -->
                </tbody>
              </table>
          </div>
        </div>

    </div> <!-- ðŸ‘ˆ CLOSE the outer two-column wrapper -->

    <!-- Shared Inventory Image Viewer (used by POS + Intake thumbnail helper) -->
    <dialog id="inventoryImageViewer" class="rounded-2xl p-0">
      <form method="dialog" class="p-3 w-[90vw] max-w-xl">
        <h3 class="section-title mb-2">Image Preview</h3>

        <img
          id="inventoryImageViewerImg"
          src=""
          alt="Item Image"
          class="max-h-[70vh] w-full h-auto object-contain bg-base-200 rounded-lg"
          style="display:block;max-width:100%;height:auto;max-height:70vh;margin:0 auto;"
        />

        <div class="flex justify-end mt-3">
          <button class="btn btn-ghost btn-sm" type="submit">Close</button>
        </div>
      </form>
    </dialog>

    <!-- BELOW: Sales to delist -->
    <div id="pos-sales-delist" class="card p-3 mt-3">
      <div class="flex items-center justify-between mb-2">
        <div class="section-title">Sales to Delist</div>
        <div class="flex items-center gap-2">
            <button id="pos-sales-Refresh" class="btn btn-sm">Refresh</button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <div class="table-wrap">
          <table class="table table-fixed">
            <colgroup>
              <col style="width:120px" />
              <col style="width:80px" />
              <col style="width:25ch" /> <!-- Payment column fixed to ~40 characters -->
              <col style="width:40px" />
              <col style="width:80px" />
              <col style="width:100px" />
              <col style="width:100px" />
            </colgroup>
            <thead>
              <tr>
                <th class="text-left">Date</th>
                <th class="text-left">SKU</th>
                <th class="text-left">Item</th>
                <th class="text-left">QTY</th>
                <th class="text-left">Final Price</th>
                <th class="text-left">Vendoo</th>
                <th class="text-left">Action</th>
              </tr>
            </thead>
            <tbody id="pos-sales-delist-body">
              <!-- rows -->
            </tbody>
          </table>
      </div>
    </div>
  </div>
</div>
