<!-- /screens/inventory-intake.html -->
<div id="inventory-intake-screen" class="screen px-4 py-4 max-w-6xl mx-auto">
  <!-- Header + actions (top, like legacy) -->
  <div class="mb-3 flex items-center justify-between">
    <h1 class="text-2xl font-semibold">Inventory ▸ Intake</h1>
  </div>

  <!-- Access denied (if API 403) -->
  <div id="intake-access-denied" class="hidden border border-red-300 bg-red-50 text-red-800 rounded p-3 mb-4">
    Access denied. You do not have permission to view this screen.
  </div>

  <!-- Main form card (mirrors legacy sectioning) -->
  <section class="card rounded-2xl shadow p-4 mb-4">
    <form id="intakeForm" autocomplete="off">
      <!-- NEW ▸ Photos (above Basic Item Details) -->
      <div id="photosCard" class="card mb-4">
        <h2 class="sectionTitle flex items-center justify-between">
          Photos
          <span class="text-sm text-gray-600" id="photosCount">0 / 15</span>
        </h2>
  
        <!-- Actions -->
        <div class="flex flex-wrap gap-2 mb-3">
          <button id="openCameraBtn" type="button" class="btn btn-primary btn-sm">
            Take Photo
          </button>
          <label class="btn btn-ghost btn-sm cursor-pointer">
            Upload Photo
            <input id="photoFileInput" type="file" accept="image/*" multiple class="hidden" />
          </label>
          
          <!-- keep a hidden camera input as a fallback, not visible in UI -->
          <input id="photoCameraInput" type="file" accept="image/*" capture="environment" class="hidden" />

          <button id="photoReorderToggle" type="button" class="btn btn-ghost btn-sm" title="Toggle drag-to-reorder">
            Reorder
          </button>
        </div>
  
        <!-- Grid -->
        <div id="photosGrid" class="grid gap-2 place-items-start"
           style="grid-template-columns:repeat(auto-fill,140px);grid-auto-rows:140px;">
          <!-- thumbnails injected here -->
        </div>
  
        <p class="text-sm text-gray-600 mt-2">
          Tips: you can add up to 15 photos. Tap a photo to <em>Crop</em>, <em>Replace</em>, <em>Delete</em>, or <em>Set Primary</em>.
        </p>
      </div>

      
      <!-- A) Basic Item Details -->
      <div class="card">
        <h2 class="sectionTitle">Basic Item Details</h2>
        <div class="legacy-grid-2">
          <div class="field">
            <label>Item Name / Description</label>
            <input id="titleInput" type="text" placeholder="e.g., Monster High Doll - Frankie Stein" />
          </div>
      
          <div class="field">
            <label>Price (USD)</label>
            <input id="priceInput" type="number" step="0.01" min="0" placeholder="0.00" />
          </div>
      
          <div class="field">
            <label>Qty</label>
            <input id="qtyInput" type="number" step="1" min="0" placeholder="1" />
          </div>
      
          <div class="field">
            <label>Cost of Goods (USD)</label>
            <input id="costInput" type="number" step="0.01" min="0" placeholder="0.00" />
          </div>
      
          <div class="field">
            <label>Category</label>
            <select id="categorySelect"></select>
            <div class="muted mono" id="categoryCodeHint"></div>
          </div>
      
          <div class="field">
            <label>Store Location</label>
            <select id="storeLocationSelect"></select>
          </div>
      
          <div class="field">
            <label>Case#/Bin#/Shelf#</label>
            <input id="caseBinShelfInput" type="text" placeholder="e.g., Case 1 / Bin A" />
          </div>
      
          <div class="field">
            <label>Sales Channel</label>
            <select id="salesChannelSelect"></select>
          </div>
        </div>
      </div>

      <!-- B) Marketplace Listing Details (renamed from Vendoo) -->
      <div id="marketplaceSection" class="card">
        <h2 class="sectionTitle">Marketplace Listing Details</h2>
      
        <div class="field">
          <label>Marketplace Category</label>
          <select id="marketplaceCategorySelect"></select>
          <div class="muted">Category Path: <span id="marketplaceCategoryPath" class="mono">—</span></div>
        </div>
      
        <div class="legacy-grid-3" style="margin-top:10px">
          <div class="field">
            <label>Condition</label>
            <select id="conditionSelect"></select>
          </div>
          <div class="field">
            <label>Brand</label>
            <select id="brandSelect"></select>
          </div>
          <div class="field">
            <label>Primary Color</label>
            <select id="colorSelect"></select>
          </div>
        </div>
      
        <div class="field" style="margin-top:10px">
          <label>Long Description</label>
          <textarea id="longDescriptionTextarea" placeholder="Enter a detailed description…"></textarea>
        </div>
      
        <div id="shippingBlock" style="margin-top:10px">
          <h3 class="sectionTitle" style="margin:0 0 8px">Shipping</h3>
          <div class="legacy-grid-3">
            <div class="field">
              <label>Shipping Box</label>
              <select id="shippingBoxSelect"></select>
            </div>
            <div class="field">
              <label>Weight (lb)</label>
              <input id="weightLbInput" type="number" min="0" step="1" readonly />
            </div>
            <div class="field">
              <label>Weight (oz)</label>
              <input id="weightOzInput" type="number" min="0" step="1" readonly />
            </div>
            <div class="field">
              <label>Length</label>
              <input id="lengthInput" type="number" min="0" step="1" readonly />
            </div>
            <div class="field">
              <label>Width</label>
              <input id="widthInput" type="number" min="0" step="1" readonly />
            </div>
            <div class="field">
              <label>Height</label>
              <input id="heightInput" type="number" min="0" step="1" readonly />
            </div>
          </div>
        </div>

        <!-- NEW: Crosslist to Marketplaces (below Shipping) -->
        <div id="marketplaceCrosslistBlock" class="hidden" style="margin-top:12px">
          <h3 class="sectionTitle" style="margin:0 0 8px">Crosslist to Marketplaces</h3>

          <!-- Tiles container; filled by JS from meta.marketplaces -->
          <div id="marketplaceTiles"
               class="flex flex-wrap gap-2"
               role="group"
               aria-labelledby="marketplaceTilesHeader"
               aria-describedby="marketplaceTilesHelp">
          </div>

          <div id="marketplaceTilesHelp" class="text-sm text-gray-600 mt-1">
            Select one or more marketplaces. Disabled tiles mean not connected for your tenant — ask a manager to connect.
          </div>
          <div id="marketplaceTilesError" class="text-sm text-red-600 mt-1 hidden">
            Select at least one marketplace.
          </div>
          <!-- Cards container: marketplace-specific placeholder cards mount here -->
          <div id="marketplaceCards" class="mt-3 flex flex-col gap-3" aria-live="polite"></div>
        </div>
      </div>  <!-- end of Marketplace Listing Details card -->
      
      
      <!-- C) Actions row -->
      <div class="actions flex gap-2">
        <button id="btnAddSingle_bottom" class="btn btn-primary btn-sm opacity-60 cursor-not-allowed" disabled>Add Single Item</button>
        <button id="btnAddBulk_bottom" class="btn btn-ghost btn-sm opacity-60 cursor-not-allowed" disabled>Add to Bulk List</button>
        <button id="intake-draft" class="btn btn-ghost btn-sm opacity-60 cursor-not-allowed" disabled>Save as Draft</button>
      </div>

       <div class="actions" style="margin-top:8px">
         
          <button class="btn btn-ghost btn-sm" id="copyTitleBtn" disabled title="Enabled in Phase 2">Copy Title</button>
          <button class="btn btn-ghost btn-sm" id="copySkuBtn" disabled title="Enabled in Phase 2">Copy SKU</button>
          <button class="btn btn-ghost btn-sm" id="copySkuLocationBtn" disabled title="Enabled in Phase 2">Copy SKU + Location</button>
          <button class="btn btn-ghost btn-sm" id="copyPriceBtn" disabled title="Enabled in Phase 2">Copy Price</button>
          <button class="btn btn-ghost btn-sm" id="copyXeasyBtn" disabled title="Enabled in Phase 2">Copy for Xeasy</button>
          <button class="btn btn-ghost btn-sm" id="copyBusinessDetailsBtn" disabled title="Enabled in Phase 2">Copy Business Details</button>
      </div>

      <!-- Bottom tabs (true tabs) -->
      <div class="tabs">
        <div
          id="intakeTabBar"
          class="tabBar flex gap-2 mb-2"
          role="tablist"
          aria-label="Recent activity tabs"
        >
          <button
            id="tabDrafts"
             type="button"
            class="btn btn-ghost btn-sm"
            role="tab"
            aria-selected="true"
            aria-controls="paneDrafts"
            tabindex="0"
          >
            Recent Drafts
          </button>

          <button
            id="tabInventory"
            type="button"
            class="btn btn-ghost btn-sm"
            role="tab"
            aria-selected="false"
            aria-controls="paneInventory"
            tabindex="-1"
          >
            Active Inventory
          </button>

          <button
            id="tabBulk"
            type="button"
            class="btn btn-ghost btn-sm"
            role="tab"
            aria-selected="false"
            aria-controls="paneBulk"
            tabindex="-1"
            disabled
            title="Bulk Entry is coming soon"
          >
            Bulk Entry
          </button>
        </div>

        <!-- Drafts pane (default visible) -->
        <section
          id="paneDrafts"
          role="tabpanel"
          aria-labelledby="tabDrafts"
        >
          <div id="recentDraftsHeader" data-recent-drafts-header class="flex items-center justify-between mb-2">
            <h3 class="sectionTitle m-0">Recent Drafts</h3>
          </div>
        
          <table class="table text-sm">
            <thead>
              <tr>
                <th>Saved</th>
                <th>Image</th>
                <th>SKU</th>
                <th>Title</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Category</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="recentDraftsTbody"></tbody>
          </table>
        </section>


        <!-- Inventory pane (hidden by default; lazy-loaded) -->
        <section
          id="paneInventory"
          role="tabpanel"
          aria-labelledby="tabInventory"
          class="hidden"
          aria-hidden="true"
          hidden
        >
          <div id="recentInventoryHeader" data-recent-inventory-header class="flex items-center justify-between mb-2">
            <h3 class="sectionTitle m-0">Active Inventory</h3>
          </div>
        
          <table class="table text-sm">
            <thead>
              <tr>
                <th>Saved</th>
                <th>Image</th>
                <th>SKU</th>
                <th>Title</th>
                <th>Price</th>
                <th>QTY</th>
                <th>Category</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="recentInventoryTbody"></tbody>
          </table>
          <!-- Inventory Image Viewer (moved below so Drafts can use it too) -->
        </section>

        <!-- Shared Image Viewer (used by BOTH Recent Drafts + Active Inventory) -->
        <dialog id="inventoryImageViewer" class="rounded-2xl p-0">
          <form method="dialog" class="p-3 w-[90vw] max-w-xl">
            <h3 class="sectionTitle mb-2">Image Preview</h3>

            <img
              id="inventoryImageViewerImg"
              src=""
              alt="Item Image"
              class="max-h-[70vh] w-full h-auto object-contain bg-base-200 rounded-lg"
              style="display:block;max-width:100%;height:auto;max-height:70vh;margin:0 auto;"
            />

            <div class="flex justify-end mt-3">
              <button class="btn btn-ghost btn-sm" type="submit">Close</button>
            </div>
          </form>
        </dialog>


        <!-- Bulk Entry pane (placeholder) -->
        <section
          id="paneBulk"
          role="tabpanel"
          aria-labelledby="tabBulk"
          class="hidden"
          aria-hidden="true"
          hidden
        >
          <div class="text-gray-500 text-sm">Bulk Entry is coming soon.</div>
        </section>
      </div>

      
    </div>

    
    
      
            
     
    </form>
  </section>

  <!-- Duplicate Photos Prompt (only used when loading a duplicate) -->
  <dialog id="duplicatePhotosDialog" class="rounded-2xl p-0">
    <form method="dialog" class="p-3 w-[90vw] max-w-md">
      <h3 class="sectionTitle mb-2">Reuse Photos?</h3>
      <p class="text-sm mb-3">
        This item was loaded from an existing listing. Do you want to reuse the photos from the original item?
      </p>
      <div class="flex gap-2 justify-end">
        <button
          id="duplicatePhotosNo"
          type="button"
          class="btn btn-ghost btn-sm"
        >
          No, start with empty photos
        </button>
        <button
          id="duplicatePhotosYes"
          type="button"
          class="btn btn-primary btn-sm"
        >
          Yes, reuse photos
        </button>
      </div>
    </form>
  </dialog>
  
<!-- Crop Modal -->
<dialog id="cropDialog" class="rounded-2xl p-0">
  <form method="dialog" class="p-3 w-[90vw] max-w-xl">
    <h3 class="sectionTitle mb-2">Crop Photo</h3>

    <!-- Canvas cropper -->
    <div class="border rounded-2xl overflow-hidden mb-2">
      <canvas id="cropCanvas" width="600" height="600" style="display:block;max-width:100%;height:auto"></canvas>
    </div>

    <!-- Controls -->
    <div class="flex items-center justify-between gap-3 mb-3">
      <label class="text-sm">Zoom
        <input id="cropZoom" type="range" min="1" max="3" step="0.01" value="1" />
      </label>
      <div class="text-sm">Drag to reposition</div>
    </div>

    <div class="flex gap-2 justify-end">
      <button id="cropCancelBtn" type="button" class="btn btn-ghost btn-sm">Cancel</button>
      <button id="cropSaveBtn"   type="button" class="btn btn-primary btn-sm">Save Crop</button>
    </div>
  </form>
</dialog>


<!-- Camera Modal -->
<dialog id="cameraDialog" class="rounded-2xl p-0">
  <form method="dialog" class="p-3 w-[90vw] max-w-xl">
    <h3 class="sectionTitle mb-2">Take Photo</h3>

    <div class="border rounded-2xl overflow-hidden mb-2">
      <video id="cameraVideo" autoplay playsinline style="display:block;max-width:100%;width:100%;height:auto"></video>
      <canvas id="cameraCanvas" width="1920" height="1080" style="display:none"></canvas>
    </div>

    <div class="flex gap-2 justify-between">
      <div class="text-sm text-gray-600">If your browser blocks the camera, use “Upload Photo”.</div>
      <div class="flex gap-2">
        <button id="cameraCancelBtn" type="button" class="btn btn-ghost btn-sm">Cancel</button>
        <button id="cameraSnapBtn"   type="button" class="btn btn-primary btn-sm">Take Photo</button>
      </div>
    </div>
  </form>
</dialog>
<!-- end intake.html -->
